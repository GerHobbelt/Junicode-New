#!/bin/bash

outputtype="ttf"

instanceparam="-i"

generateufo=true

for arg in $@
do
  if [ $arg == "otf" ]
  then
    outputtype=$arg
  elif [ $arg == "variable" ]
  then
    outputtype=$arg
    instanceparam=""
  elif [ $arg == "variable-cff2" ]
  then
    outputtype=$arg
    instanceparam=""
  elif [ $arg == "u" ]
  then
    generateufo=false
  fi

done

if [ "$generateufo" = true ]
then
  echo "Generating UFOs and designspace file from Glyphs source"
  glyphs2ufo --no-preserve-glyphsapp-metadata --propagate-anchors --generate-GDEF --write-public-skip-export-glyphs Junicode-width.glyphs
  if [ $? -ne 0 ]
  then
    echo "glyphs2ufo failed"
    exit 1
  fi
  echo "Cleaning up designspace file"
  xsltproc -o Junicode-width-fixed.designspace fix_wdth_axis.xsl Junicode-width.designspace
  if [ $? -ne 0 ]
  then
   echo "xsltproc failed"
   exit 1
  fi
fi

echo "building font(s)"
fontmake -o $outputtype $instanceparam -m "Junicode-width-fixed.designspace"
if [ $? -ne 0 ]
then
 echo "fontmake failed"
 exit 1
fi
